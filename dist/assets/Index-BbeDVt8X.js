import{f as X,v as G,u as q,i as z,j as H,r as F,l as J,m as Q,o as Y,D as Z,n as ee,a,b as n,g as b,w as E,T as te,c as D,_ as se,e as u,d as s,I as T,h as d,S as le,B as v,K as $,F as k,x as w,t as m,L as M,E as N,y as ae}from"./index-htZnyubk.js";import{_ as oe}from"./MainButton-DJMPo5N5.js";import{_ as ie}from"./Loader-Bz4ZUWxB.js";import{P as ne,_ as j}from"./swiper-cm27vhrU.js";const re={class:"overflow-y-auto h-screen pt-20 flex flex-col"},ce={key:0,class:"flex flex-col gap-y-4 pb-4"},ue={key:0,class:"px-4"},de=s("span",null,"Назад",-1),pe=["src"],fe=["src"],_e={class:"px-4 flex justify-between items-start gap-x-2"},ve={class:"font-medium text-lg"},be={key:1,class:"flex flex-col gap-y-4"},me={class:"px-4"},xe={class:"flex w-full justify-between border-[1.5px] border-hint_color rounded-xl p-0.5"},he=["onClick"],ke={class:"carousel carousel-center w-full px-4 space-x-2"},we={key:2,class:"flex flex-col gap-y-4"},ge=s("span",{class:"text-sm text-hint_color"},[M("На аккаунте ранее не было"),s("br"),M("подписок")],-1),ye={class:"w-8 h-8 rounded-lg bg-white shadow-sm overflow-clip"},Be={key:0,class:"flex w-full h-full justify-center items-center from-[#6BF792] to-[#36A254] bg-gradient-to-b rounded-lg"},Ce={class:"carousel carousel-center w-full px-4 space-x-2"},Ee={key:3,class:"flex flex-col gap-y-4"},De={class:"carousel carousel-center w-full px-4 space-x-2"},Se={class:"px-4 flex flex-col gap-y-4"},Ae={key:0,class:"flex flex-col gap-y-1"},Ie=s("h3",null,"Описание:",-1),Pe={class:"whitespace-pre-wrap text-hint_color text-sm"},Fe={class:"flex flex-col gap-y-2"},Te={key:0,class:"flex gap-x-1 justify-between text-sm flex-wrap"},je=s("h3",{class:"text-hint_color"},"Платформа:",-1),Ue={__name:"Index",setup(Oe){const R=[ne],U=X(D.DIRECTUS.API).with(G()),g=q(),S=z(),K=H(),i=window.Telegram.WebApp,e=F(null),A=F(!0);let y=null,B=null;const I=()=>{window.history.length>1?S.go(-1):S.push({name:"INDEX"})};J(()=>{var c;i.onEvent("backButtonClicked",I),i.BackButton.show(),i.onEvent("mainButtonClicked",P),y=N(()=>t,o=>{C(o.plan)},{deep:!0}),B=N(()=>g.orders,()=>{C(t.plan)},{deep:!0}),e.value&&(C(),i.MainButton.color=((c=e.value)==null?void 0:c.platform)==="Xbox"?"#5AAD5D":"#2E60E7",i.MainButton.show())}),Q(()=>{y&&(y(),y=null),B&&(B(),B=null),i.offEvent("backButtonClicked",I),i.BackButton.hide(),i.offEvent("mainButtonClicked",P),i.MainButton.hide()}),Y(()=>{L(K.params.id)});const O=[{id:0,title:"Essential"},{id:1,title:"Extra"},{id:2,title:"Deluxe"}],L=async c=>{var f;A.value=!0;let o=await U.request(Z("Subscriptions",c,{fields:["*.*.*"]}));e.value=o,e.value.template==="PP"?(t.subscribe=O[0],t.plan=e.value.prices_slot_1[0].variants_id):e.value.template==="GP"?(t.subscribe="For old users",t.plan=e.value.prices_slot_2[0].variants_id):e.value.template==="EA"&&(t.subscribe=null,t.plan=e.value.prices_slot_1[0].variants_id),i.MainButton.color=((f=e.value)==null?void 0:f.platform)==="Xbox"?"#5AAD5D":"#2E60E7",C(),i.MainButton.show(),A.value=!1},t=ee({subscribe:null,plan:null,productCollection:"Subscriptions"}),V=()=>{t.plan&&g.setOrderInBasket({product:e.value,productOption:{subscribe:t.subscribe,plan:t.plan,productCollection:t.productCollection}})},_=F(""),P=()=>{_.value==="Добавить в корзину"?V():S.push({name:"BASKET"})},C=c=>{var f;const o=g.orders.find(x=>x.product.id===e.value.id);o?(f=o.productOption)!=null&&f.plan&&c&&g.orders.find(l=>l.product.id===e.value.id&&l.productOption.plan.id===c.id&&l.productOption.productCollection===t.productCollection)===void 0?_.value="Добавить в корзину":_.value="Перейти в корзину":_.value="Добавить в корзину",i.MainButton.text=_.value},W=()=>{let c=e.value.title,o=`t.me/${D.DEEP_LINK}?startapp=subscription-${e.value.id}`;window.open(`https://t.me/share/url?url=${o}&text=${c}`)};return(c,o)=>(a(),n("main",re,[b(se),b(te,{name:"fade",appear:""},{default:E(()=>{var f,x;return[A.value?(a(),v(ie,{key:1})):(a(),n("div",ce,[u(i).initDataUnsafe.user?d("",!0):(a(),n("div",ue,[s("button",{onClick:I,class:"flex bg-blue w-fit pl-2 pr-4 py-1.5 rounded-xl items-center gap-x-1 font-medium"},[b(u(T),{icon:"ion:chevron-back-outline"}),de])])),s("div",null,[b(u(le),{modules:R,class:"h-80","slides-per-view":1,pagination:{clickable:!0}},{default:E(()=>[e.value.cover&&!e.value.is_banner?(a(),v(u($),{key:0},{default:E(()=>[s("img",{src:u(D).DIRECTUS.API+"/assets/"+e.value.cover.filename_disk,class:"w-full h-full object-cover"},null,8,pe)]),_:1})):d("",!0),e.value.images&&e.value.images.length>0?(a(!0),n(k,{key:1},w(e.value.images,(l,p)=>(a(),v(u($),{key:p},{default:E(()=>[s("img",{src:u(D).DIRECTUS.API+"/assets/"+l.directus_files_id.id,class:"w-full h-full object-cover"},null,8,fe)]),_:2},1024))),128)):d("",!0)]),_:1})]),s("div",_e,[s("h1",ve,m(e.value.title)+" "+m((f=t.subscribe)!=null&&f.title?t.subscribe.title:"")+" "+m(t.plan.title),1),s("button",{onClick:W,class:"text-3xl h-8 w-8 justify-center items-center flex active:opacity-75 transition-all text-hint_color"},[b(u(T),{icon:"ion:share-outline"})])]),e.value.template==="PP"?(a(),n("div",be,[s("div",me,[s("div",xe,[(a(),n(k,null,w(O,(l,p)=>{var r;return s("button",{onClick:()=>{t.subscribe=l},key:p,class:ae(["flex font-medium text-sm p-2.5 transition-all rounded-lg w-1/3 justify-center",((r=t.subscribe)==null?void 0:r.id)===l.id&&"from-[#4F7DF9] to-[#2E60E7] bg-gradient-to-b"])},m(l.title),11,he)}),64))])]),s("div",ke,[(a(!0),n(k,null,w(t.subscribe.id===0&&e.value.prices_slot_1||t.subscribe.id===1&&e.value.prices_slot_2||t.subscribe.id===2&&e.value.prices_slot_3,({variants_id:l},p)=>{var r;return a(),v(j,{key:p,title:l.title,tab:l,active:l.id===((r=t.plan)==null?void 0:r.id),onChange:o[0]||(o[0]=h=>t.plan=h),platform:e.value.platform},null,8,["title","tab","active","platform"])}),128))])])):d("",!0),e.value.template==="GP"?(a(),n("div",we,[s("button",{onClick:o[1]||(o[1]=()=>{t.subscribe==="For new users"?t.subscribe="For old users":t.subscribe="For new users"}),class:"flex justify-between text-start px-4 gap-x-2 items-center w-full"},[ge,s("span",ye,[t.subscribe==="For new users"?(a(),n("span",Be,[b(u(T),{icon:"mdi:check-bold",class:"text-2xl"})])):d("",!0)])]),s("div",Ce,[(a(!0),n(k,null,w(t.subscribe==="For new users"?e.value.prices_slot_1:e.value.prices_slot_2,({variants_id:l},p)=>{var r;return a(),v(j,{key:p,title:l.title,tab:l,active:l.id===((r=t.plan)==null?void 0:r.id),onChange:o[2]||(o[2]=h=>t.plan=h),platform:e.value.platform},null,8,["title","tab","active","platform"])}),128))])])):d("",!0),e.value.template==="EA"?(a(),n("div",Ee,[s("div",De,[(a(!0),n(k,null,w(e.value.prices_slot_1,({variants_id:l},p)=>{var r;return a(),v(j,{key:p,title:l.title,tab:l,active:l.id===((r=t.plan)==null?void 0:r.id),onChange:o[3]||(o[3]=h=>t.plan=h),platform:e.value.platform},null,8,["title","tab","active","platform"])}),128))])])):d("",!0),s("div",Se,[e.value.description?(a(),n("div",Ae,[Ie,s("p",Pe,m(e.value.description),1)])):d("",!0),s("div",Fe,[e.value.compatible_platforms?(a(),n("div",Te,[je,s("p",null,m(e.value.compatible_platforms),1)])):d("",!0)])]),(x=u(i).initDataUnsafe)!=null&&x.user?d("",!0):(a(),v(oe,{key:4,title:_.value,onSubmit:P},null,8,["title"]))]))]}),_:1})]))}};export{Ue as default};
