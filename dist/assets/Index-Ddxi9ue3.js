import{i as F,j as G,f as J,v as K,r as o,M as L,l as X,m as $,o as H,O as I,p as Q,a,b as i,d as t,e as w,g as m,h as v,s as C,z as W,A as Y,w as D,T as E,c as Z,q as b,I as R,F as y,x as k,y as P,H as ee,B as N,P as te,Q as ae}from"./index-htZnyubk.js";const se={class:"relative flex flex-col"},le={key:0,class:"px-4"},oe=t("span",null,"Назад",-1),ne={class:"flex justify-center p-4 gap-x-2 fixed z-20 left-0 right-0 top-0 bg-bg_color"},ie={class:"w-full min-512:w-[480px]"},ce={class:"flex transition-all items-center gap-x-2.5 text-left bg-hint_bg_color rounded-xl h-12 px-4 w-full"},re={key:0,class:P(["pb-4 flex flex-col gap-y-2"])},ue={key:0,class:"px-4 py-4 flex justify-center"},de=t("span",{class:"text-sm text-hint_color text-semibold"},"Хм, ничего не найдено :(",-1),fe=[de],pe={key:1,class:"grid grid-cols-2 gap-4 p-4"},ve={class:"flex justify-center flex-col items-center gap-y-2.5 px-4"},_e=t("span",{class:"font-medium"},"Не нашли нужную игру? Напишите нам!",-1),me={key:0,class:"grid grid-cols-2 gap-4 p-4"},ge={class:"flex flex-col h-52 bg-hint_bg_color animate-pulse rounded-xl overflow-clip w-full"},we={__name:"Index",setup(he){const d=window.Telegram.WebApp,S=F();G();const g=()=>{S.go(-1)},h=J(Z.DIRECTUS.API).with(K()),n=o(!1),r=o(null),u=o(null),f=o("Xbox"),V=o(null),s=o(""),B=o(null),j=o(null);S.beforeEach((e,l,p)=>{j.value=l,p()});const z=()=>{s.value="",r.value=null,u.value=null};L((e,l,p)=>{e.path.includes("/game")?console.log("Переход на маршрут, связанный с играми"):(z(),console.log("Переход на маршрут не связанный с играми")),p()});const A=async()=>{let e=await h.request(b("start_params",{fields:["sale_prices"]}));B.value=e.sale_prices},T=async()=>{s.value.length>=3&&(n.value=!0,window.sessionStorage.setItem("search",s.value),r.value=await M(),u.value=await O(),n.value=!1)},M=async()=>{n.value=!0;let e=await h.request(b("Games",{fields:["*.*.*"],filter:{status:{_eq:"published"},platform:{_eq:f.value},_or:[{title:{_icontains:s.value}},{meta:{_icontains:s.value}}]},limit:25}));return n.value=!1,e},O=async()=>{n.value=!0;let e=await h.request(b("Donations",{fields:["*.*.*"],filter:{status:{_eq:"published"},_or:[{platform:{_eq:f.value}},{other:{_eq:"Yes"}}],_or:[{title:{_icontains:s.value}},{meta:{_icontains:s.value}}]},limit:25}));return n.value=!1,e};console.log("z v russia goyda america suck my dick");const _=o(null),q=o(0),U=()=>{_.value&&(q.value=_.value.scrollTop)};return X(async()=>{const e=window.localStorage.getItem("activeTab");e&&(f.value=JSON.parse(e).platform),d.onEvent("backButtonClicked",g),d.BackButton.show(),await I(),ee(_,q)}),$(()=>{d.offEvent("backButtonClicked",g),d.BackButton.hide()}),H(async()=>{await I(),n.value=!0;const e=window.localStorage.getItem("activeTab");e&&(f.value=JSON.parse(e).platform);let l=window.sessionStorage.getItem("search");l&&(s.value=l),await A(),await T(),n.value=!1}),(e,l)=>{const p=Q("auto-animate");return a(),i("div",{class:"overflow-y-auto h-screen pt-20 flex flex-col",ref_key:"scrollableElement",ref:_,onScroll:U},[t("div",se,[w(d).initDataUnsafe.user?v("",!0):(a(),i("div",le,[t("button",{onClick:g,class:"flex bg-blue w-fit pl-2 pr-4 py-1.5 rounded-xl items-center gap-x-1 font-medium"},[m(w(R),{icon:"ion:chevron-back-outline"}),oe])])),t("header",ne,[t("div",ie,[t("div",ce,[m(w(R),{icon:"ion:search",class:"text-xl shrink-0"}),C(t("input",{"onUpdate:modelValue":l[0]||(l[0]=c=>s.value=c),onKeyup:l[1]||(l[1]=Y(c=>{c.target.blur(),T()},["enter"])),ref_key:"inputRef",ref:V,class:"placeholder:text-hint_color line-clamp-1 text-sm w-full h-full outline-none bg-transparent",placeholder:"Найти игру"},null,544),[[W,s.value]])])])]),m(E,{name:"fade",appear:""},{default:D(()=>[r.value&&u.value?(a(),i("div",re,[r.value.length<1&&u.value.length<1?(a(),i("div",ue,fe)):v("",!0),r.value.length>0||u.value.length>0?C((a(),i("div",pe,[(a(!0),i(y,null,k(r.value,(c,x)=>(a(),N(te,{key:x,product:c,sale_prices:B.value},null,8,["product","sale_prices"]))),128)),(a(!0),i(y,null,k(u.value,(c,x)=>(a(),N(ae,{key:x,product:c},null,8,["product"]))),128))])),[[p]]):v("",!0),t("div",ve,[_e,t("a",{class:P(["w-full rounded-xl px-4 py-2.5 text-center shadow-sm active:opacity-75 font-medium",f.value==="Xbox"?"bg-green":"bg-blue"]),href:"https://t.me/lavka_assistant",target:"_blank"},"Написать Продавцу Лавки",2)])])):v("",!0)]),_:1}),m(E,{name:"fade"},{default:D(()=>[n.value?(a(),i("div",me,[(a(),i(y,null,k(3,c=>t("div",ge)),64))])):v("",!0)]),_:1})])],544)}}};export{we as default};
