import{f as W,v as X,u as F,i as L,j as V,r as E,l as q,m as z,o as G,D as H,n as J,a as s,b as p,g as v,w as b,T as Q,c as g,_ as Y,e as i,d as t,I as S,h as f,S as Z,B as _,K as A,F as T,x as O,t as w,E as $}from"./index-htZnyubk.js";import{_ as ee}from"./MainButton-DJMPo5N5.js";import{_ as te}from"./Loader-Bz4ZUWxB.js";import{P as ae,_ as se}from"./swiper-cm27vhrU.js";const oe={class:"h-screen overflow-y-auto pt-20 flex flex-col"},le={key:0,class:"flex flex-col gap-y-4 pb-4"},ne={key:0,class:"px-4"},ie=t("span",null,"Назад",-1),ce=["src"],ue=["src"],re={class:"px-4 flex justify-between items-start gap-x-2"},de={class:"font-medium text-lg"},pe={class:"flex flex-col gap-y-4"},fe={class:"carousel carousel-center w-full px-4 space-x-2"},ve={class:"px-4 flex flex-col gap-y-4"},_e={key:0,class:"flex flex-col gap-y-1"},me=t("h3",null,"Описание:",-1),he={class:"whitespace-pre-wrap text-hint_color text-sm"},xe={class:"flex flex-col gap-y-2"},ke={key:0,class:"flex gap-x-1 justify-between text-sm flex-wrap"},be=t("h3",{class:"text-hint_color"},"Платформа:",-1),De={__name:"Index",setup(ge){const M=[ae],P=W(g.DIRECTUS.API).with(X()),m=F(),B=L(),j=V(),a=window.Telegram.WebApp,e=E(null),y=E(!0);let h=null,x=null;const C=()=>{window.history.length>1?B.go(-1):B.push({name:"INDEX"})};q(()=>{var n;a.onEvent("backButtonClicked",C),a.BackButton.show(),a.onEvent("mainButtonClicked",D),h=$(()=>o,l=>{k(l.plan)},{deep:!0}),x=$(()=>m.orders,()=>{k(o.plan)},{deep:!0}),e.value&&(k(),a.MainButton.color=((n=e.value)==null?void 0:n.platform)==="Xbox"?"#5AAD5D":"#2E60E7",a.MainButton.show())}),z(()=>{h&&(h(),h=null),x&&(x(),x=null),a.offEvent("backButtonClicked",C),a.BackButton.hide(),a.offEvent("mainButtonClicked",D),a.MainButton.hide()}),G(()=>{N(j.params.id)});const N=async n=>{var c;y.value=!0;let l=await P.request(H("Donations",n,{fields:["*.*.*"]}));e.value=l,e.value.prices&&e.value.prices.length>0&&(o.plan=e.value.prices[0].variants_id),a.MainButton.color=((c=e.value)==null?void 0:c.platform)==="Xbox"?"#5AAD5D":"#2E60E7",k(),a.MainButton.show(),y.value=!1},o=J({subscribe:null,plan:null,productCollection:"Donations"}),R=()=>{o.plan&&m.setOrderInBasket({product:e.value,productOption:{subscribe:o.subscribe,plan:o.plan,productCollection:o.productCollection}})},r=E(""),D=()=>{r.value==="Добавить в корзину"?R():B.push({name:"BASKET"})},k=n=>{var c;const l=m.orders.find(u=>u.product.id===e.value.id);l?(c=l.productOption)!=null&&c.plan&&n&&m.orders.find(d=>d.product.id===e.value.id&&d.productOption.plan.id===n.id&&d.productOption.productCollection===o.productCollection)===void 0?r.value="Добавить в корзину":r.value="Перейти в корзину":r.value="Добавить в корзину",a.MainButton.text=r.value},U=()=>{let n=e.value.title,l=`t.me/${g.DEEP_LINK}?startapp=donation-${e.value.id}`;window.open(`https://t.me/share/url?url=${l}&text=${n}`)};return(n,l)=>(s(),p("main",oe,[v(Y),v(Q,{name:"fade"},{default:b(()=>{var c;return[y.value?(s(),_(te,{key:1})):(s(),p("div",le,[i(a).initDataUnsafe.user?f("",!0):(s(),p("div",ne,[t("button",{onClick:C,class:"flex bg-blue w-fit pl-2 pr-4 py-1.5 rounded-xl items-center gap-x-1 font-medium"},[v(i(S),{icon:"ion:chevron-back-outline"}),ie])])),t("div",null,[v(i(Z),{modules:M,class:"h-80","slides-per-view":1,pagination:{clickable:!0}},{default:b(()=>[e.value.cover?(s(),_(i(A),{key:0},{default:b(()=>[t("img",{src:i(g).DIRECTUS.API+"/assets/"+e.value.cover.filename_disk,class:"w-full h-full object-cover"},null,8,ce)]),_:1})):f("",!0),e.value.images&&e.value.images.length>0?(s(!0),p(T,{key:1},O(e.value.images,(u,d)=>(s(),_(i(A),{key:d},{default:b(()=>[t("img",{src:i(g).DIRECTUS.API+"/assets/"+u.directus_files_id.id,class:"w-full h-full object-cover"},null,8,ue)]),_:2},1024))),128)):f("",!0)]),_:1})]),t("div",re,[t("h1",de,w(e.value.title)+" "+w(o.plan.title),1),t("button",{onClick:U,class:"text-3xl h-8 w-8 justify-center items-center flex active:opacity-75 transition-all text-hint_color"},[v(i(S),{icon:"ion:share-outline"})])]),t("div",pe,[t("div",fe,[(s(!0),p(T,null,O(e.value.prices,({variants_id:u},d)=>{var I;return s(),_(se,{key:d,title:u.title,tab:u,active:u.id===((I=o.plan)==null?void 0:I.id),onChange:l[0]||(l[0]=K=>o.plan=K),platform:e.value.platform},null,8,["title","tab","active","platform"])}),128))])]),t("div",ve,[e.value.description?(s(),p("div",_e,[me,t("p",he,w(e.value.description),1)])):f("",!0),t("div",xe,[e.value.compatible_platforms?(s(),p("div",ke,[be,t("p",null,w(e.value.compatible_platforms),1)])):f("",!0)])]),(c=i(a).initDataUnsafe)!=null&&c.user?f("",!0):(s(),_(ee,{key:1,title:r.value,onSubmit:D},null,8,["title"]))]))]}),_:1})]))}};export{De as default};
