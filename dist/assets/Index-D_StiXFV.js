import{i as z,j as A,f as P,v as V,r as a,l as $,m as F,o as U,p as j,a as t,b as n,g as u,e as w,d as D,h as i,w as y,T as x,c as J,q as L,_ as M,I as O,t as Q,s as W,F as X,x as Y,B,y as G,D as K,H as Z,Q as ee}from"./index-htZnyubk.js";import{_ as ae}from"./Loader-Bz4ZUWxB.js";const te={key:0,class:"px-4 pb-2.5"},se=D("span",null,"Назад",-1),le={key:0,class:G(["flex flex-col gap-y-2"])},oe={key:0,class:"px-4 font-medium text-lg"},ne={className:"grid grid-cols-2 gap-4 p-4"},ie={__name:"Index",setup(re){const r=window.Telegram.WebApp,S=z(),f=()=>{S.go(-1)},q=A(),m=P(J.DIRECTUS.API).with(V()),s=a(!1),o=a(null),v=a(1),g=a(50),d=a("Xbox"),p=q.params.id,_=a(null),C=async()=>{let e=await m.request(K("Subcategories",p,{fields:["*.*.*"]}));_.value=e},h=async()=>{s.value=!0;let e;p==="other"?e={other:{_eq:"Yes"},_or:[{platform:{_eq:d.value}},{platform:{_null:!0}}]}:(await C(),e={platform:{_eq:d.value},other:{_null:!0},subcategory:{_eq:p}});let c=await m.request(L("Donations",{fields:["*.*.*"],filter:{status:{_eq:"published"},...e},page:v.value,limit:g.value}));return c&&c.length<g.value&&(k.value=!0),c},l=a(null),b=a(0),T=()=>{l.value&&(b.value=l.value.scrollTop,E())};$(()=>{r.onEvent("backButtonClicked",f),r.BackButton.show(),Z(l,b)}),F(()=>{r.offEvent("backButtonClicked",f),r.BackButton.hide()}),U(async()=>{s.value=!0;const e=window.localStorage.getItem("activeTab");e&&(d.value=JSON.parse(e).platform),o.value=await h(),s.value=!1});const E=()=>{l.value.scrollTop+l.value.clientHeight>=l.value.scrollHeight-30&&(s.value||I())},k=a(!1),I=async()=>{if(!k.value){s.value=!0,v.value=v.value+1;let e=await h();if(!e)return;o.value=[...o.value,...e]}s.value=!1};return(e,c)=>{const N=j("auto-animate");return t(),n("main",{class:"flex flex-col pb-4 overflow-y-auto h-screen pt-20",ref_key:"scrollableElement",ref:l,onScroll:T},[u(M),w(r).initDataUnsafe.user?i("",!0):(t(),n("div",te,[D("button",{onClick:f,class:"flex bg-blue w-fit pl-2 pr-4 py-1.5 rounded-xl items-center gap-x-1 font-medium"},[u(w(O),{icon:"ion:chevron-back-outline"}),se])])),u(x,{name:"fade"},{default:y(()=>[o.value&&o.value.length>0?(t(),n("div",le,[_.value?(t(),n("h3",oe,Q(_.value.title),1)):i("",!0),W((t(),n("div",ne,[(t(!0),n(X,null,Y(o.value,(H,R)=>(t(),B(ee,{key:R,product:H,autoResize:!0},null,8,["product"]))),128))])),[[N]])])):i("",!0)]),_:1}),u(x,{name:"fade"},{default:y(()=>[s.value?(t(),B(ae,{key:0})):i("",!0)]),_:1})],544)}}};export{ie as default};
