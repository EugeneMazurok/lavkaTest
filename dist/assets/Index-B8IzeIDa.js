import{f as W,v as F,u as L,i as V,j as z,r as y,l as H,m as J,o as Q,D as Y,n as Z,a as s,b as c,g as x,w,T as ee,c as A,q as te,_ as ae,e as d,d as a,I as T,h as o,S as se,B as _,K as $,F as le,x as ie,t as m,E as G}from"./index-htZnyubk.js";import{_ as oe}from"./MainButton-DJMPo5N5.js";import{_ as ne}from"./Loader-Bz4ZUWxB.js";import{_ as D,P as ce}from"./swiper-cm27vhrU.js";const re={class:"h-screen overflow-y-auto pt-20 flex flex-col"},ue={key:0,class:"flex flex-col gap-y-4 pb-4"},pe={key:0,class:"px-4"},de=a("span",null,"Назад",-1),_e=["src"],fe=["src"],ve={class:"px-4 flex justify-between items-start gap-x-2"},me={class:"font-medium text-lg"},xe={class:"flex flex-col gap-y-2"},be={class:"carousel carousel-center w-full px-4 space-x-2"},he={key:0,class:"px-4 text-sm text-hint_color"},ke={key:1,class:"flex px-4 w-full"},ge={class:"bg-[#9D9D9D] w-full flex flex-col rounded-xl px-4 py-2.5"},ye=a("span",{class:"font-medium text-black"},"Важно:",-1),we={key:0,class:"text-black text-sm"},Be={key:1,class:"text-black text-sm"},Pe={class:"px-4 flex flex-col gap-y-4"},Se={key:0,class:"flex flex-col gap-y-1"},Ce=a("h3",null,"Описание:",-1),De={class:"whitespace-pre-wrap text-hint_color text-sm"},Ee={class:"flex flex-col gap-y-2"},Ie={key:0,class:"flex gap-x-1 justify-between text-sm flex-wrap"},je=a("h3",{class:"text-hint_color"},"Платформа:",-1),Ae={key:1,class:"flex gap-x-1 justify-between text-sm flex-wrap"},Te=a("h3",{class:"text-hint_color"},"Перевод:",-1),$e={key:2,class:"flex gap-x-1 justify-between text-sm flex-wrap"},Ge=a("h3",{class:"text-hint_color"},"Дата релиза:",-1),qe={__name:"Index",setup(Me){const M=[ce],E=W(A.DIRECTUS.API).with(F()),b=L(),B=V(),O=z(),i=window.Telegram.WebApp,e=y(null),P=y(!0);let h=null,k=null;const S=()=>{window.history.length>1?B.go(-1):B.push({name:"INDEX"})};H(()=>{var n;i.onEvent("backButtonClicked",S),i.BackButton.show(),h=G(()=>t,l=>{g(l.plan)},{deep:!0}),k=G(()=>b.orders,()=>{g(t.plan)},{deep:!0}),i.onEvent("mainButtonClicked",C),e.value&&(g(),i.MainButton.color=((n=e.value)==null?void 0:n.platform)==="Xbox"?"#5AAD5D":"#2E60E7",i.MainButton.show())}),J(()=>{i.offEvent("backButtonClicked",S),i.BackButton.hide(),i.offEvent("mainButtonClicked",C),i.MainButton.hide(),h&&(h(),h=null),k&&(k(),k=null)}),Q(async()=>{await K(O.params.id)});const f=y(null),N=async()=>{let n=await E.request(te("start_params",{fields:["sale_prices"]}));f.value=n.sale_prices.includes(e.value.platform)},K=async n=>{var r;P.value=!0;let l=await E.request(Y("Games",n,{fields:["*.*.*"]}));console.log(l),e.value=l,await N(),e.value.price_sale&&f.value?(t.subscribe=!1,t.plan={id:"price_sale",price:e.value.price_sale}):e.value.price_standart?(t.subscribe=!1,t.plan={id:"price_standart",price:e.value.price_standart}):(t.subscribe=!0,t.plan={id:"price_subscription",price:e.value.price_subscription}),i.MainButton.color=((r=e.value)==null?void 0:r.platform)==="Xbox"?"#5AAD5D":"#2E60E7",g(),i.MainButton.show(),P.value=!1},t=Z({subscribe:null,plan:null,productCollection:"Games"}),X=()=>{t.plan&&b.setOrderInBasket({product:e.value,productOption:{subscribe:t.subscribe,plan:t.plan,productCollection:t.productCollection}})},u=y(""),C=()=>{u.value==="Добавить в корзину"?X():B.push({name:"BASKET"})},g=n=>{var r;const l=b.orders.find(p=>p.product.id===e.value.id);if(l)if((r=l.productOption)!=null&&r.plan&&n){const p=b.orders.find(v=>v.product.id===e.value.id&&v.productOption.plan.id===n.id&&v.productOption.productCollection===t.productCollection);console.log("PEDIKI"),console.log(p),p===void 0?u.value="Добавить в корзину":u.value="Перейти в корзину"}else u.value="Перейти в корзину";else u.value="Добавить в корзину";i.MainButton.text=u.value},q=()=>{let n=e.value.title,l=`t.me/${A.DEEP_LINK}?startapp=game-${e.value.id}`;window.open(`https://t.me/share/url?url=${l}&text=${n}`)};return(n,l)=>(s(),c("main",re,[x(ae),x(ee,{name:"fade",appear:""},{default:w(()=>{var r,p,v,I;return[P.value?(s(),_(ne,{key:1})):(s(),c("div",ue,[d(i).initDataUnsafe.user?o("",!0):(s(),c("div",pe,[a("button",{onClick:S,class:"flex bg-blue w-fit pl-2 pr-4 py-1.5 rounded-xl items-center gap-x-1 font-medium"},[x(d(T),{icon:"ion:chevron-back-outline"}),de])])),a("div",null,[x(d(se),{modules:M,class:"h-80","slides-per-view":1,pagination:{clickable:!0}},{default:w(()=>{var j;return[(j=e.value)!=null&&j.cover_link?(s(),_(d($),{key:0},{default:w(()=>[a("img",{src:e.value.cover_link,class:"w-full h-full object-cover"},null,8,_e)]),_:1})):o("",!0),e.value.images?(s(!0),c(le,{key:1},ie(e.value.images.split(","),(R,U)=>(s(),_(d($),{key:U},{default:w(()=>[a("img",{src:R.trim(),class:"w-full h-full object-cover"},null,8,fe)]),_:2},1024))),128)):o("",!0)]}),_:1})]),a("div",ve,[a("h1",me,m(e.value.title),1),a("button",{onClick:q,class:"text-3xl h-8 w-8 justify-center items-center flex active:opacity-75 transition-all text-hint_color"},[x(d(T),{icon:"ion:share-outline"})])]),a("div",xe,[a("div",be,[e.value.price_sale&&f.value?(s(),_(D,{key:0,title:e.value.price_subscription?e.value.platform==="PS"?"без PS Plus":"без Game Pass":!1,tab:{price:e.value.price_sale},active:((r=t.plan)==null?void 0:r.id)==="price_sale",onChange:l[0]||(l[0]=()=>{t.plan={id:"price_sale",price:e.value.price_sale},t.subscribe=!1}),platform:e.value.platform},null,8,["title","tab","active","platform"])):e.value.price_standart?(s(),_(D,{key:1,title:e.value.price_subscription&&f.value?e.value.platform==="PS"?"без PS Plus":"без Game Pass":!1,tab:{price:e.value.price_standart},active:((p=t.plan)==null?void 0:p.id)==="price_standart",onChange:l[1]||(l[1]=()=>{t.plan={id:"price_standart",price:e.value.price_standart},t.subscribe=!1}),platform:e.value.platform},null,8,["title","tab","active","platform"])):o("",!0),e.value.price_subscription&&f.value?(s(),_(D,{key:2,title:e.value.platform==="PS"?"с PS Plus":"с Game Pass",tab:{price:e.value.price_subscription},active:((v=t.plan)==null?void 0:v.id)==="price_subscription",onChange:l[2]||(l[2]=()=>{t.plan={id:"price_subscription",price:e.value.price_subscription},t.subscribe=!0}),platform:e.value.platform},null,8,["title","tab","active","platform"])):o("",!0)]),e.value.sale_date_end&&f.value?(s(),c("span",he,"Скидка до "+m(e.value.sale_date_end),1)):o("",!0)]),e.value.price_subscription?(s(),c("div",ke,[a("div",ge,[ye,e.value.platform==="Xbox"?(s(),c("p",we,"Покупка по цене «с Game Pass» возможна, если на вашем аккаунте есть подписка Game Pass")):o("",!0),e.value.platform==="PS"?(s(),c("p",Be,"Покупка по цене «с PS Plus» возможна, если на вашем аккаунте есть подписка PlayStation Plus")):o("",!0)])])):o("",!0),a("div",Pe,[e.value.description?(s(),c("div",Se,[Ce,a("p",De,m(e.value.description),1)])):o("",!0),a("div",Ee,[e.value.compatible_platforms?(s(),c("div",Ie,[je,a("p",null,m(e.value.compatible_platforms),1)])):o("",!0),e.value.language?(s(),c("div",Ae,[Te,a("p",null,m(e.value.language),1)])):o("",!0),e.value.release_date?(s(),c("div",$e,[Ge,a("p",null,m(e.value.release_date),1)])):o("",!0)])]),(I=d(i).initDataUnsafe)!=null&&I.user?o("",!0):(s(),_(oe,{key:2,title:u.value,onSubmit:C},null,8,["title"]))]))]}),_:1})]))}};export{qe as default};
